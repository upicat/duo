# Duo项目架构说明

## 1. 项目概述

Duo是一个基于Spring Boot和React的全栈应用程序，采用前后端分离架构，提供了完整的用户认证、授权和基础功能框架。项目使用Docker容器化部署，支持多环境配置和一键式部署。

## 2. 技术栈

### 2.1 后端技术栈

- **核心框架**: Spring Boot 3.x
- **安全框架**: Spring Security + JWT
- **数据访问**: Spring Data JPA
- **数据库**: MySQL 8.0
- **缓存**: Redis
- **API文档**: Springdoc OpenAPI (Swagger)
- **构建工具**: Maven
- **容器化**: Docker

### 2.2 前端技术栈

- **核心框架**: React 18.x
- **UI组件库**: Ant Design
- **状态管理**: Redux Toolkit
- **路由**: React Router
- **HTTP客户端**: Axios
- **构建工具**: Vite
- **容器化**: Docker

### 2.3 DevOps工具

- **容器编排**: Docker Compose
- **反向代理**: Nginx
- **CI/CD**: 支持GitHub Actions/Jenkins

## 3. 系统架构

### 3.1 整体架构

```
                    ┌─────────────┐
                    │    Nginx    │
                    │  反向代理   │
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │                         │
     ┌────────▼─────────┐     ┌────────▼─────────┐
     │                  │     │                  │
     │  React Frontend  │     │ Spring Backend   │
     │    前端应用      │     │    后端应用      │
     │                  │     │                  │
     └──────────────────┘     └────────┬─────────┘
                                       │
                      ┌────────────────┴────────────────┐
                      │                                 │
            ┌─────────▼──────────┐         ┌────────────▼─────────┐
            │                    │         │                      │
            │      MySQL         │         │       Redis          │
            │    关系型数据库    │         │     缓存服务器       │
            │                    │         │                      │
            └────────────────────┘         └──────────────────────┘
```

### 3.2 后端架构

后端采用经典的分层架构设计：

1. **控制器层 (Controller)**: 处理HTTP请求，进行参数验证和结果返回
2. **服务层 (Service)**: 实现业务逻辑，处理事务管理
3. **数据访问层 (Repository)**: 与数据库交互，实现数据持久化
4. **实体层 (Entity)**: 映射数据库表结构
5. **DTO层 (Data Transfer Object)**: 定义数据传输对象，用于API交互
6. **安全层 (Security)**: 处理认证和授权
7. **异常处理层 (Exception)**: 统一异常处理
8. **配置层 (Config)**: 系统配置

### 3.3 前端架构

前端采用组件化设计：

1. **页面组件 (Pages)**: 对应路由的页面组件
2. **UI组件 (Components)**: 可复用的UI组件
3. **状态管理 (Store)**: 使用Redux管理全局状态
4. **API服务 (Services)**: 封装API调用
5. **工具类 (Utils)**: 通用工具函数
6. **路由 (Router)**: 页面路由配置
7. **样式 (Styles)**: 全局样式和主题配置

## 4. 数据库设计

### 4.1 核心表结构

- **users**: 用户表，存储用户基本信息
- **roles**: 角色表，定义系统角色
- **permissions**: 权限表，定义系统权限
- **user_roles**: 用户角色关联表
- **role_permissions**: 角色权限关联表

### 4.2 ER图

```
┌─────────────┐       ┌───────────────┐       ┌─────────────────┐
│   users     │       │  user_roles   │       │     roles       │
├─────────────┤       ├───────────────┤       ├─────────────────┤
│ id          │       │ user_id       ├───────┤ id              │
│ username    │       │ role_id       │       │ name            │
│ password    │       └───────────────┘       │ description     │
│ email       │                               └────────┬────────┘
│ phone       │                                        │
│ nickname    │                                        │
│ status      │                               ┌────────┴────────┐
│ created_at  │                               │ role_permissions│
│ updated_at  │                               ├─────────────────┤
└─────────────┘                               │ role_id         │
                                             │ permission_id   │
                                             └────────┬────────┘
                                                      │
                                             ┌────────┴────────┐
                                             │   permissions   │
                                             ├─────────────────┤
                                             │ id              │
                                             │ name            │
                                             │ description     │
                                             └─────────────────┘
```

## 5. 安全架构

### 5.1 认证流程

1. 用户提交用户名和密码
2. 后端验证凭据并生成JWT令牌
3. 前端存储令牌并在后续请求中使用
4. 后端通过JWT过滤器验证令牌

### 5.2 授权流程

1. 用户登录后，后端加载用户角色和权限
2. 前端根据用户权限动态渲染UI
3. 后端使用Spring Security注解控制API访问权限

## 6. 部署架构

### 6.1 开发环境

- 使用Docker Compose启动所有服务
- 前端热重载开发服务器
- 后端直接连接到开发数据库

### 6.2 生产环境

- 使用Docker Compose编排所有服务
- Nginx作为反向代理和静态资源服务器
- 后端服务集群化部署
- 数据库主从复制
- Redis集群

### 6.3 部署流程

1. 构建前后端应用
2. 构建Docker镜像
3. 推送镜像到仓库
4. 在目标环境拉取镜像
5. 使用Docker Compose启动服务

## 7. 扩展性设计

- **模块化**: 系统按功能模块划分，便于扩展
- **微服务准备**: 架构设计考虑了未来微服务拆分的可能性
- **API版本控制**: 支持API版本控制，便于平滑升级
- **可配置性**: 通过配置文件和环境变量实现高度可配置

## 8. 监控和日志

- **应用监控**: 集成Spring Actuator
- **日志系统**: 使用SLF4J + Logback
- **审计日志**: 记录关键操作的审计日志
- **性能监控**: 支持集成Prometheus和Grafana

## 9. 未来规划

- 微服务架构演进
- 引入消息队列处理异步任务
- 实现分布式事务
- 引入服务网格(Service Mesh)
- 支持Kubernetes部署
